(function(a,c){jPlayerPlaylist=function(b,h,g){var f=this;this.current=0;this.removing=this.shuffled=this.loop=!1;this.cssSelector=a.extend({},this._cssSelector,b);this.lrcMap=new Map();this.options=a.extend(!0,{keyBindings:{next:{key:39,fn:function(){f.next()}},previous:{key:37,fn:function(){f.previous()}}}},this._options,g);this.playlist=[];this.original=[];this._initPlaylist(h);this.cssSelector.title=this.cssSelector.cssSelectorAncestor+" .jp-title";this.cssSelector.playlist=this.cssSelector.cssSelectorAncestor+" .jp-playlist";this.cssSelector.next=this.cssSelector.cssSelectorAncestor+" .jp-next";this.cssSelector.previous=this.cssSelector.cssSelectorAncestor+" .jp-previous";this.cssSelector.shuffle=this.cssSelector.cssSelectorAncestor+" .jp-shuffle";this.cssSelector.shuffleOff=this.cssSelector.cssSelectorAncestor+" .jp-shuffle-off";this.options.cssSelectorAncestor=this.cssSelector.cssSelectorAncestor;this.options.repeat=function(d){f.loop=d.jPlayer.options.loop};a(this.cssSelector.jPlayer).bind(a.jPlayer.event.ready,function(){f._init()});a(this.cssSelector.jPlayer).bind(a.jPlayer.event.ended,function(){f.next()});a(this.cssSelector.jPlayer).bind(a.jPlayer.event.play,function(d){a(this).jPlayer("pauseOthers")});a(this.cssSelector.jPlayer).bind(a.jPlayer.event.resize,function(d){d.jPlayer.options.fullScreen?a(f.cssSelector.title).show():a(f.cssSelector.title).hide()});a(this.cssSelector.previous).click(function(){f.previous();a(this).blur();return !1});a(this.cssSelector.next).click(function(){f.next();a(this).blur();return !1});a(this.cssSelector.shuffle).click(function(){f.shuffle(!0);return !1});a(this.cssSelector.shuffleOff).click(function(){f.shuffle(!1);return !1}).hide();this.options.fullScreen||a(this.cssSelector.title).hide();a(this.cssSelector.playlist+" ul").empty();this._createItemHandlers();a(this.cssSelector.jPlayer).jPlayer(this.options)};jPlayerPlaylist.prototype={_cssSelector:{jPlayer:"#jquery_jplayer_1",cssSelectorAncestor:"#jp_container_1"},_options:{playlistOptions:{autoPlay:!1,loopOnPrevious:!1,shuffleOnLoop:!0,enableRemoveControls:!1,displayTime:"slow",addTime:"fast",removeTime:"fast",shuffleTime:"slow",itemClass:"jp-playlist-item",freeGroupClass:"jp-free-media",freeItemClass:"jp-playlist-item-free",removeItemClass:"jp-playlist-item-remove"}},option:function(e,d){if(d===c){return this.options.playlistOptions[e]}this.options.playlistOptions[e]=d;switch(e){case"enableRemoveControls":this._updateControls();break;case"itemClass":case"freeGroupClass":case"freeItemClass":case"removeItemClass":this._refresh(!0),this._createItemHandlers()}return this},_init:function(){var b=this;this._refresh(function(){b.options.playlistOptions.autoPlay?b.play(b.current):b.select(b.current)})},_initPlaylist:function(b){this.current=0;this.removing=this.shuffled=!1;this.original=a.extend(!0,[],b);this._originalPlaylist()},_originalPlaylist:function(){var b=this;this.playlist=[];a.each(this.original,function(d){b.playlist[d]=b.original[d]})},_refresh:function(e){var g=this;if(e&&!a.isFunction(e)){a(this.cssSelector.playlist+" ul").empty(),a.each(this.playlist,function(d){a(g.cssSelector.playlist+" ul").append(g._createListItem(g.playlist[d]))}),this._updateControls()}else{var f=a(this.cssSelector.playlist+" ul").children().length?this.options.playlistOptions.displayTime:0;a(this.cssSelector.playlist+" ul").slideUp(f,function(){var h=a(this);a(this).empty();a.each(g.playlist,function(d){h.append(g._createListItem(g.playlist[d]));$(".ui-reelList-canvas").append(g._createListItem_fyw(g.playlist[d],d))});g._updateControls();a.isFunction(e)&&e();g.playlist.length?a(this).slideDown(g.options.playlistOptions.displayTime):a(this).show()})}var b=!this.options.playlistOptions.height?31:this.options.playlistOptions.height;$(".ui-reelList-canvas").css("height",(b*g.playlist.length)+"px");$(".playlist-length span").html(g.playlist.length);$(".ui-reelList-row").dblclick(function(){var d=parseInt($(this).attr("reellist-row"));g.current!==d?g.play(d):a(g.cssSelector.jPlayer).jPlayer("play");a(this).blur();g.current=d});$(".ui-reelList-row").hover(function(){$(this).addClass("ui-reelList-row-hover")},function(){$(this).removeClass("ui-reelList-row-hover")});$(".ui-reelList-centerLoading").css("display","none")},_createListItem:function(b){var h=this,g="<li><div>",g=g+("<a href='javascript:;' class='"+this.options.playlistOptions.removeItemClass+"'>&times;</a>");if(b.free){var f=!0,g=g+("<span class='"+this.options.playlistOptions.freeGroupClass+"'>(");a.each(b,function(d,e){a.jPlayer.prototype.format[d]&&(f?f=!1:g+=" | ",g+="<a class='"+h.options.playlistOptions.freeItemClass+"' href='"+e+"' tabindex='1'>"+d+"</a>")});g+=")</span>"}g+="<a href='javascript:;' class='"+this.options.playlistOptions.itemClass+"' tabindex='1'>"+b.title+(b.artist?" <span class='jp-artist'>by "+b.artist+"</span>":"")+"</a>";return g+="</div></li>"},_createListItem_fyw:function(d,e){var b=!this.options.playlistOptions.height?31:this.options.playlistOptions.height;var h=b*(e);var g=(e+1)%2==0?"odd":"even";var i=this,f='<div style="top: '+h+'px;" reellist-row="'+e+'" class="ui-widget-content ui-reelList-row emptyHeart '+g+'">';f+='<div class="ui-reelList-cell  c0"><div class="ui-reelList-checkbox" ><span></span></div> ';f+='<span class="listening-icon"> </span><span class="ui-reelList-songname">'+d.title+"</span></div>";f+='<div class="ui-reelList-cell  c1"><a class="a-link" href="javascript:;"> '+d.artist+"</a></div>";f+='<div class="ui-reelList-cell  c2">--</div>';f+='<div class="ui-reelList-cell heartColumn c3"><div class="playlist-heart"> </div></div></div>';return f},_createItemHandlers:function(){var b=this;a(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.itemClass).on("click","a."+this.options.playlistOptions.itemClass,function(){var d=a(this).parent().parent().index();b.current!==d?b.play(d):a(b.cssSelector.jPlayer).jPlayer("play");a(this).blur();return !1});a(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.freeItemClass).on("click","a."+this.options.playlistOptions.freeItemClass,function(){a(this).parent().parent().find("."+b.options.playlistOptions.itemClass).click();a(this).blur();return !1});a(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.removeItemClass).on("click","a."+this.options.playlistOptions.removeItemClass,function(){var d=a(this).parent().parent().index();b.remove(d);a(this).blur();return !1})},_updateControls:function(){this.options.playlistOptions.enableRemoveControls?a(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).show():a(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).hide();this.shuffled?(a(this.cssSelector.shuffleOff).show(),a(this.cssSelector.shuffle).hide()):(a(this.cssSelector.shuffleOff).hide(),a(this.cssSelector.shuffle).show())},_highlight:function(b){this.playlist.length&&b!==c&&(a(this.cssSelector.playlist+" .jp-playlist-current").removeClass("jp-playlist-current"),a(this.cssSelector.playlist+" li:nth-child("+(b+1)+")").addClass("jp-playlist-current").find(".jp-playlist-item").addClass("jp-playlist-current"),a(this.cssSelector.title+" li").html(this.playlist[b].title+(this.playlist[b].artist?" <span class='jp-artist'>by "+this.playlist[b].artist+"</span>":"")))},setPlaylist:function(b){this._initPlaylist(b)},add:function(b,d){a(this.cssSelector.playlist+" ul").append(this._createListItem(b)).find("li:last-child").hide().slideDown(this.options.playlistOptions.addTime);this._updateControls();this.original.push(b);this.playlist.push(b);d?this.play(this.playlist.length-1):1===this.original.length&&this.select(0)},remove:function(b){var d=this;if(b===c){return this._initPlaylist([]),this._refresh(function(){a(d.cssSelector.jPlayer).jPlayer("clearMedia")}),!0}if(this.removing){return !1}b=0>b?d.original.length+b:b;0<=b&&b<this.playlist.length&&(this.removing=!0,a(this.cssSelector.playlist+" li:nth-child("+(b+1)+")").slideUp(this.options.playlistOptions.removeTime,function(){a(this).remove();if(d.shuffled){var e=d.playlist[b];a.each(d.original,function(f){if(d.original[f]===e){return d.original.splice(f,1),!1}})}else{d.original.splice(b,1)}d.playlist.splice(b,1);d.original.length?b===d.current?(d.current=b<d.original.length?d.current:d.original.length-1,d.select(d.current)):b<d.current&&d.current--:(a(d.cssSelector.jPlayer).jPlayer("clearMedia"),d.current=0,d.shuffled=!1,d._updateControls());d.removing=!1}));return !0},select:function(b){b=0>b?this.original.length+b:b;0<=b&&b<this.playlist.length?(this.current=b,this._highlight(b),a(this.cssSelector.jPlayer).jPlayer("setMedia",this.playlist[this.current])):this.current=0;$(".songname").html(this.playlist[this.current].title);$(".log").html(this.playlist[this.current].artist);$(".ui-reelList-row").removeClass("ui-reelList-active").eq(b).addClass("ui-reelList-active");$(".lrcWrap ul").html("")},play:function(b){b=0>b?this.original.length+b:b;0<=b&&b<this.playlist.length?this.playlist.length&&(this.select(b),a(this.cssSelector.jPlayer).jPlayer("play")):b===c&&a(this.cssSelector.jPlayer).jPlayer("play")},pause:function(){a(this.cssSelector.jPlayer).jPlayer("pause")},next:function(){var b=this.current+1<this.playlist.length?this.current+1:0;this.loop?0===b&&this.shuffled&&this.options.playlistOptions.shuffleOnLoop&&1<this.playlist.length?this.shuffle(!0,!0):this.play(b):0<b&&this.play(b)},previous:function(){var b=0<=this.current-1?this.current-1:this.playlist.length-1;(this.loop&&this.options.playlistOptions.loopOnPrevious||b<this.playlist.length-1)&&this.play(b)},shuffle:function(b,f){var e=this;b===c&&(b=!this.shuffled);(b||b!==this.shuffled)&&a(this.cssSelector.playlist+" ul").slideUp(this.options.playlistOptions.shuffleTime,function(){(e.shuffled=b)?e.playlist.sort(function(){return 0.5-Math.random()}):e._originalPlaylist();e._refresh(!0);f||!a(e.cssSelector.jPlayer).data("jPlayer").status.paused?e.play(0):e.select(0);a(this).slideDown(e.options.playlistOptions.shuffleTime)})}}})(jQuery);
